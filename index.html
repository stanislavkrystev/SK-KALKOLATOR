<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Калкулатор за пръскане v2.0</title>
  <meta name="theme-color" content="#0b1020" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <style>
    :root { --radius: 16px; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; margin: 0; padding: 24px; background: #0b1020; color: #e8ecf1; }
    .app { max-width: 980px; margin: 0 auto; }
    h1 { margin: 0 0 12px; font-size: 28px; }
    p.lead { margin: 0 0 20px; opacity: .9; }
    .card { background: #121a33; border: 1px solid #1b274d; border-radius: var(--radius); padding: 20px; margin-bottom: 16px; box-shadow: 0 6px 24px rgba(0,0,0,.25); }
    .row { display: grid; grid-template-columns: repeat(12, 1fr); gap: 12px; }
    .col-6 { grid-column: span 6; } .col-4 { grid-column: span 4; } .col-8 { grid-column: span 8; } .col-12 { grid-column: span 12; } .col-3 { grid-column: span 3; }
    label { display: block; font-size: 13px; opacity: .85; margin-bottom: 6px; }
    input, select { width: 100%; padding: 12px 12px; border-radius: 12px; border: 1px solid #243463; background: #0e1530; color: #e8ecf1; font-size: 14px; }
    input:focus, select:focus { outline: none; border-color: #3a57a6; box-shadow: 0 0 0 3px rgba(58,87,166,.25); }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; }
    .btn { padding: 10px 14px; border-radius: 12px; border: 1px solid #2a3f7a; background: #162350; color: #e8ecf1; cursor: pointer; font-weight: 600; }
    .btn:hover { background: #1b2b61; }
    .btn.secondary { background: transparent; }
    .result { background: #0f1733; border: 1px dashed #2a3f7a; padding: 16px; border-radius: 14px; }
    .muted { opacity: .75; }
    .grid-slim { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); gap: 10px; margin-top: 10px; }
    .kpi { background: #0a1128; border: 1px solid #203168; border-radius: 12px; padding: 12px; text-align: center; }
    .kpi b { font-size: 18px; display: block; }
    .footer { font-size: 12px; opacity: .8; margin-top: 8px; }
    .tabbar { display:flex; gap:6px; margin-bottom:10px; }
    .tabbar button { padding:8px 12px; border-radius: 999px; border:1px solid #2a3f7a; background:#0e1530; color:#e8ecf1; cursor:pointer; }
    .tabbar button.active { background:#1b2b61; border-color:#3a57a6; }
    .hidden { display:none; }
    .watermark { opacity:.25; font-size:12px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    .watermark strong { opacity:.85; }
    .subtle { font-size:12px; opacity:.8; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #2a3f7a; }
    .sep { height:1px; background:#243463; margin:10px 0; opacity:.5; }
  </style>
</head>
<body>
  <div class="app">
    <div class="watermark card" style="margin-top:0;">
      <div><strong>Станислав Кръстев</strong> • Калкулатор за пръскане v2.0</div>
      <div>✉️ stanislav90030@gmail.com • ☎️ +359883482854</div>
    </div>

    <h1>Калкулатор за пръскане v2.0</h1>
    <p class="lead">Сметни вода, препарати и брой зареждания. Работи по два метода: <b>по площ</b> или <b>по концентрация %</b>. Поддържа до 4 различни препарата наведнъж.</p>

    <div class="card">
      <div class="tabbar">
        <button id="tab-area" class="active" onclick="switchTab('area')">Метод: По площ</button>
        <button id="tab-conc" onclick="switchTab('conc')">Метод: По концентрация %</button>
      </div>

      <!-- TAB: AREA -->
      <div id="pane-area">
        <div class="row">
          <div class="col-4">
            <label>Площ (дка)</label>
            <input id="area" type="number" step="0.01" min="0" placeholder="напр. 2.5" />
          </div>
          <div class="col-4">
            <label>Норма вода (л/дка)</label>
            <input id="waterPerDecare" type="number" step="0.1" min="0" placeholder="напр. 40" />
          </div>
          <div class="col-4">
            <label>Капацитет пръскачка (л)</label>
            <input id="tankSizeA" type="number" step="0.1" min="0" placeholder="напр. 16" />
          </div>
        </div>
        <div class="sep"></div>
        <div class="subtle">Препарати (доза на дка). Остави празно, ако не ползваш дадения препарат.</div>
        <div class="row" id="area-products">
          <div class="col-3"><label>Препарат 1 – име</label><input id="p1name" placeholder="напр. Шампион" /></div>
          <div class="col-3"><label>Доза 1 (мл/г/дка)</label><input id="p1dose" type="number" step="0.1" min="0" placeholder="напр. 50" /></div>
          <div class="col-3"><label>Препарат 2 – име</label><input id="p2name" placeholder="напр. Кристалон" /></div>
          <div class="col-3"><label>Доза 2 (мл/г/дка)</label><input id="p2dose" type="number" step="0.1" min="0" /></div>

          <div class="col-3"><label>Препарат 3 – име</label><input id="p3name" /></div>
          <div class="col-3"><label>Доза 3 (мл/г/дка)</label><input id="p3dose" type="number" step="0.1" min="0" /></div>
          <div class="col-3"><label>Препарат 4 – име</label><input id="p4name" /></div>
          <div class="col-3"><label>Доза 4 (мл/г/дка)</label><input id="p4dose" type="number" step="0.1" min="0" /></div>
        </div>

        <div class="controls" style="margin-top:14px;">
          <button class="btn" onclick="calcArea()">Изчисли</button>
          <button class="btn secondary" onclick="resetArea()">Нулирай</button>
        </div>
        <div id="resultArea" class="result" style="margin-top:14px; display:none;"></div>
      </div>

      <!-- TAB: CONCENTRATION -->
      <div id="pane-conc" class="hidden">
        <div class="row">
          <div class="col-4">
            <label>Общо количество разтвор (л)</label>
            <input id="totalSolution" type="number" step="0.1" min="0" placeholder="напр. 100" />
          </div>
          <div class="col-4">
            <label>Капацитет пръскачка (л)</label>
            <input id="tankSizeB" type="number" step="0.1" min="0" placeholder="напр. 16" />
          </div>
          <div class="col-4">
            <label class="muted">Бележка</label>
            <div class="muted">Въведи проценти за отделни препарати (сбор ≤ 100%). Празните се игнорират.</div>
          </div>
        </div>
        <div class="sep"></div>
        <div class="row">
          <div class="col-3"><label>Препарат 1 – име</label><input id="c1name" placeholder="напр. Тор (течен)" /></div>
          <div class="col-3"><label>% 1</label><input id="c1pct" type="number" step="0.01" min="0" max="100" placeholder="напр. 0.2" /></div>
          <div class="col-3"><label>Препарат 2 – име</label><input id="c2name" /></div>
          <div class="col-3"><label>% 2</label><input id="c2pct" type="number" step="0.01" min="0" max="100" /></div>

          <div class="col-3"><label>Препарат 3 – име</label><input id="c3name" /></div>
          <div class="col-3"><label>% 3</label><input id="c3pct" type="number" step="0.01" min="0" max="100" /></div>
          <div class="col-3"><label>Препарат 4 – име</label><input id="c4name" /></div>
          <div class="col-3"><label>% 4</label><input id="c4pct" type="number" step="0.01" min="0" max="100" /></div>
        </div>

        <div class="controls" style="margin-top:14px;">
          <button class="btn" onclick="calcConc()">Изчисли</button>
          <button class="btn secondary" onclick="resetConc()">Нулирай</button>
        </div>
        <div id="resultConc" class="result" style="margin-top:14px; display:none;"></div>
      </div>
    </div>

    <div class="card">
      <div class="grid-slim">
        <div class="kpi"><span class="muted">Режим</span><b>Офлайн PWA</b><span class="muted">Добави към началния екран.</span></div>
        <div class="kpi"><span class="muted">Свободна версия</span><b>Без лимити</b><span class="muted">Може да се споделя.</span></div>
        <div class="kpi"><span class="muted">Автор</span><b>Станислав Кръстев</b><span class="muted">Контакт горе.</span></div>
      </div>
      <div class="footer">Провери етикетите на препаратите преди работа. При различна плътност (≠1 г/мл) сметките за мл/г се различават.</div>
    </div>
  </div>

  <script>
    function $(id){ return document.getElementById(id); }
    function round2(x){ return Math.round((x + Number.EPSILON) * 100) / 100; }
    function switchTab(kind){
      const areaBtn = $('tab-area'); const concBtn = $('tab-conc');
      const areaPane = $('pane-area'); const concPane = $('pane-conc');
      const isArea = kind === 'area';
      areaBtn.classList.toggle('active', isArea);
      concBtn.classList.toggle('active', !isArea);
      areaPane.classList.toggle('hidden', !isArea);
      concPane.classList.toggle('hidden', isArea);
    }

    function calcArea(){
      const area = parseFloat($('area').value);
      const waterPerDecare = parseFloat($('waterPerDecare').value);
      const tankSize = parseFloat($('tankSizeA').value);

      if([area, waterPerDecare].some(v => isNaN(v) || v < 0)){
        alert('Моля, въведи валидни стойности за площ и норма вода.');
        return;
      }

      const totalWater = area * waterPerDecare; // литри
      const products = [];
      for(let i=1;i<=4;i++){
        const name = ($('p'+i+'name').value || '').trim();
        const dose = parseFloat($('p'+i+'dose').value);
        if(name && !isNaN(dose) && dose>=0){
          const total = area * dose;
          products.push({name, dose, total});
        }
      }
      let refills = null;
      if(!isNaN(tankSize) && tankSize > 0){ refills = Math.ceil(totalWater / tankSize); }

      let html = '<div class="row"><div class="col-12"><b>Резултат (по площ)</b></div>';
      html += `<div class="col-6"><div class="kpi"><span class="muted">Общо вода</span><b>${round2(totalWater)} л</b></div></div>`;
      html += `<div class="col-6"><div class="kpi"><span class="muted">Препарати</span><b>${products.length} бр.</b></div></div>`;
      if(refills){ html += `<div class="col-12"><div class="kpi"><span class="muted">Брой зареждания (≈)</span><b>${refills} пъти</b><span class="muted">при резервоар ${round2(tankSize)} л</span></div></div>`; }
      if(products.length){
        html += '<div class="col-12"><div class="sep"></div><div class="subtle">Детайли по препарати</div></div>';
        products.forEach(p => {
          html += `<div class="col-6"><div class="kpi"><span class="muted">${p.name}</span><b>${round2(p.total)}</b><span class="muted">(мл/г общо)</span></div></div>`;
        });
      }
      html += '</div>';

      const box = $('resultArea');
      box.innerHTML = html;
      box.style.display = 'block';
    }

    function resetArea(){
      ['area','waterPerDecare','tankSizeA','p1name','p1dose','p2name','p2dose','p3name','p3dose','p4name','p4dose'].forEach(id => { const el=$(id); if(el) el.value=''; });
      $('resultArea').style.display = 'none';
      $('resultArea').innerHTML = '';
    }

    function calcConc(){
      const totalSolution = parseFloat($('totalSolution').value);
      const tankSize = parseFloat($('tankSizeB').value);
      if(isNaN(totalSolution) || totalSolution <= 0){
        alert('Моля, въведи валидна стойност за общо количество разтвор (л).');
        return;
      }
      const prods = [];
      let sumPct = 0;
      for(let i=1;i<=4;i++){
        const name = ($('c'+i+'name').value || '').trim();
        const pct = parseFloat($('c'+i+'pct').value);
        if(name && !isNaN(pct) && pct>=0){
          prods.push({name, pct});
          sumPct += pct;
        }
      }
      if(sumPct>100){
        alert('Сборът на процентите надвишава 100%. Моля, коригирай.');
        return;
      }
      const products = prods.map(p => ({ name:p.name, volume: totalSolution*(p.pct/100) }));
      const productSum = products.reduce((a,b)=>a+b.volume,0);
      const water = totalSolution - productSum;
      let refills = null;
      if(!isNaN(tankSize) && tankSize > 0){ refills = Math.ceil(totalSolution / tankSize); }

      let html = '<div class="row"><div class="col-12"><b>Резултат (по концентрация)</b></div>';
      html += `<div class="col-4"><div class="kpi"><span class="muted">Общо разтвор</span><b>${round2(totalSolution)} л</b></div></div>`;
      html += `<div class="col-4"><div class="kpi"><span class="muted">Вода</span><b>${round2(water)} л</b></div></div>`;
      html += `<div class="col-4"><div class="kpi"><span class="muted">Препарати</span><b>${products.length} бр.</b></div></div>`;
      if(refills){ html += `<div class="col-12"><div class="kpi"><span class="muted">Брой зареждания (≈)</span><b>${refills} пъти</b><span class="muted">при резервоар ${round2(tankSize)} л</span></div></div>`; }
      if(products.length){
        html += '<div class="col-12"><div class="sep"></div><div class="subtle">Детайли по препарати</div></div>';
        products.forEach(p => {
          html += `<div class="col-6"><div class="kpi"><span class="muted">${p.name}</span><b>${round2(p.volume)} л</b><span class="muted">(${round2((p.volume/totalSolution)*100)}%)</span></div></div>`;
        });
      }
      html += '</div>';

      const box = $('resultConc');
      box.innerHTML = html;
      box.style.display = 'block';
    }

    function resetConc(){
      ['totalSolution','tankSizeB','c1name','c1pct','c2name','c2pct','c3name','c3pct','c4name','c4pct'].forEach(id => { const el=$(id); if(el) el.value=''; });
      $('resultConc').style.display = 'none';
      $('resultConc').innerHTML = '';
    }

    if('serviceWorker' in navigator){
      window.addEventListener('load', ()=>{
        navigator.serviceWorker.register('sw.js').catch(console.error);
      });
    }
    let deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt = e; });
  </script>
</body>
</html>
